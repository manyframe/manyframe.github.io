<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2048</title>
    <style>
        body {
            background-color: transparent;
            color: #ffffff;
            font-family: 'Comfortaa', sans-serif;
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            min-height: 100vh;
        }

        h1 {
            font-size: 35px;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 20px;
        }

        #game-board {
            position: relative;
            width: 400px;
            height: 400px;
            background-color: rgba(255, 255, 255, 0.1);
            border: 1px solid #ffffff;
            border-radius: 5px;
        }

        .tile {
            position: absolute;
            width: 90px;
            height: 90px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2em;
            font-weight: bold;
            border-radius: 5px;
            color: #000;
            transition: transform 0.1s ease-in-out, background-color 0.1s ease-in-out;
        }

        .tile.new-tile {
            animation: slide-in 0.2s ease-in-out;
        }

        .tile.merged-tile {
            animation: pop 0.2s ease-in-out;
        }

        @keyframes slide-in {
            from {
                transform: scale(0);
            }
            to {
                transform: scale(1);
            }
        }

        @keyframes pop {
            from {
                transform: scale(1);
            }
            to {
                transform: scale(1.1);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 28px;
                letter-spacing: 2px;
            }

            #game-board {
                width: 90vw;
                height: 90vw;
            }

            .tile {
                width: 20vw;
                height: 20vw;
                font-size: 1.5em;
            }
        }
    </style>
</head>
<iframe 
  src="background.html" 
  style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; border: none; z-index: -1;"
></iframe>
    <h1>2048</h1>
    <div id="game-board"></div>

    <script>
        class Tile {
            constructor(value, row, col) {
                this.value = value;
                this.row = row;
                this.col = col;
                this.element = document.createElement('div');
                this.element.className = 'tile';
                this.update();
                gameBoard.appendChild(this.element);
            }

            update() {
                this.element.textContent = this.value;
                this.element.style.backgroundColor = this.getTileColor();
                this.element.style.transform = `translate(${this.col * 100}px, ${this.row * 100}px)`;
            }

            getTileColor() {
                switch (this.value) {
                    case 2: return '#eee4da';
                    case 4: return '#ede0c8';
                    case 8: return '#f2b179';
                    case 16: return '#f59563';
                    case 32: return '#f67c5f';
                    case 64: return '#f65e3b';
                    case 128: return '#edcf72';
                    case 256: return '#edcc61';
                    case 512: return '#edc850';
                    case 1024: return '#edc53f';
                    case 2048: return '#edc22e';
                    default: return 'rgba(238, 228, 218, 0.35)';
                }
            }

            remove() {
                this.element.remove();
            }
        }

        class Board {
            constructor() {
                this.grid = Array.from({ length: 4 }, () => Array(4).fill(null));
                this.tiles = [];
                this.gameBoard = document.getElementById('game-board');
                this.init();
            }

            init() {
                this.gameBoard.innerHTML = '';
                for (let i = 0; i < 4; i++) {
                    for (let j = 0; j < 4; j++) {
                        const background_tile = document.createElement('div');
                        background_tile.style.position = 'absolute';
                        background_tile.style.width = '90px';
                        background_tile.style.height = '90px';
                        background_tile.style.backgroundColor = 'rgba(238, 228, 218, 0.35)';
                        background_tile.style.borderRadius = '5px';
                        background_tile.style.top = `${i * 100 + 10}px`;
                        background_tile.style.left = `${j * 100 + 10}px`;
                        this.gameBoard.appendChild(background_tile);
                    }
                }
                this.addRandomTile();
                this.addRandomTile();
            }

            addRandomTile() {
                let emptyTiles = [];
                for (let i = 0; i < 4; i++) {
                    for (let j = 0; j < 4; j++) {
                        if (!this.grid[i][j]) {
                            emptyTiles.push({ row: i, col: j });
                        }
                    }
                }
                if (emptyTiles.length > 0) {
                    const { row, col } = emptyTiles[Math.floor(Math.random() * emptyTiles.length)];
                    const value = Math.random() < 0.9 ? 2 : 4;
                    const tile = new Tile(value, row, col);
                    this.grid[row][col] = tile;
                    this.tiles.push(tile);
                }
            }

            move(direction) {
                let changed = false;
                let promises = [];

                const moveAndMerge = (line) => {
                    let arr = line.filter(val => val);
                    for (let i = 0; i < arr.length - 1; i++) {
                        if (arr[i].value === arr[i + 1].value) {
                            arr[i].value *= 2;
                            arr[i+1].value = 0;
                            changed = true;
                        }
                    }
                    arr = arr.filter(val => val.value !== 0);
                    let missing = 4 - arr.length;
                    let zeros = Array(missing).fill(null);
                    arr = arr.concat(zeros);
                    return arr;
                };

                if (direction === 'left' || direction === 'right') {
                    for (let i = 0; i < 4; i++) {
                        const row = this.grid[i];
                        if (direction === 'right') row.reverse();
                        const newRow = moveAndMerge([...row]);
                        if (direction === 'right') newRow.reverse();
                        this.grid[i] = newRow;
                    }
                } else if (direction === 'up' || direction === 'down') {
                    for (let i = 0; i < 4; i++) {
                        const col = [this.grid[0][i], this.grid[1][i], this.grid[2][i], this.grid[3][i]];
                        if (direction === 'down') col.reverse();
                        const newCol = moveAndMerge([...col]);
                        if (direction === 'down') newCol.reverse();
                        for(let j=0; j<4; j++){
                            this.grid[j][i] = newCol[j];
                        }
                    }
                }
                
                this.tiles = this.tiles.filter(t => t.value !== 0);

                for (let i = 0; i < 4; i++) {
                    for (let j = 0; j < 4; j++) {
                        const tile = this.grid[i][j];
                        if (tile) {
                            if(tile.row !== i || tile.col !== j){
                                changed = true;
                            }
                            tile.row = i;
                            tile.col = j;
                            tile.update();
                        }
                    }
                }
                
                this.tiles.forEach(t => {
                    if(!this.grid[t.row][t.col]){
                        t.remove();
                    }
                });


                if (changed) {
                    this.addRandomTile();
                }
            }
        }

        const board = new Board();

        document.addEventListener('keydown', (e) => {
            switch (e.key) {
                case 'ArrowLeft': board.move('left'); break;
                case 'ArrowRight': board.move('right'); break;
                case 'ArrowUp': board.move('up'); break;
                case 'ArrowDown': board.move('down'); break;
            }
        });
    </script>
