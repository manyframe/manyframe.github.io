<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Graph Plotter</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300..700&display=swap" rel="stylesheet">

    <script src="https://cdn.plot.ly/plotly-2.32.0.min.js"></script>
    
    <style>
        body {
            background: linear-gradient(180deg, #07131c, #305472);
            color: #ffffff;
            font-family: 'Comfortaa', sans-serif;
            height: 100vh;
            margin: 0;
            overflow: hidden;
            display: flex;
        }
        .app-layout {
            display: flex;
            width: 100%;
            height: 100%;
            padding: 20px;
            gap: 20px;
            box-sizing: border-box;
        }
        h1 { margin: 0 0 20px 0; text-align: left; font-size: 24px; }
        .panel {
            display: flex;
            flex-direction: column;
            height: 100%;
            box-sizing: border-box;
        }
        .right-panel {
            width: 380px;
            flex-shrink: 0;
            overflow-y: auto;
            padding-right: 15px;
        }
        .center-panel {
            flex: 1;
            border-radius: 16px;
            overflow: hidden;
        }
        .control-group {
            background-color: #ffffff15;
            border: 1px solid #ffffff9f;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        .control-group-title {
            font-size: 12px;
            color: #ffffff;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: bold;
            border-bottom: 1px solid #ffffff33;
            padding-bottom: 10px;
            margin-bottom: 15px;
        }
        .input-row { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        .input-row label { flex-basis: 80px; font-size: 14px; text-align: left; }
        .input-row input[type="number"], .input-row select {
            flex: 1;
            background-color: #ffffff15;
            color: #fff;
            border: 1px solid #ffffff9f;
            border-radius: 8px;
            padding: 8px 12px;
            font-size: 14px;
            box-sizing: border-box;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23FFFFFF%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.5-12.8z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 15px top 50%;
            background-size: 10px auto;
        }
        .input-row select option {
            background: #07131c;
            color: #fff;
        }
        
        .output-div {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #ffffff33;
            font-size: 14px;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            .app-layout {
                flex-direction: column;
                padding: 10px;
                gap: 10px;
            }
            .panel {
                height: auto; /* Override fixed height */
            }
            .center-panel {
                flex: 1 1 50%;
                min-height: 300px;
                width: 100%;
            }
            .right-panel {
                width: 100%;
                flex: 1 1 50%;
                overflow-y: auto;
                padding-right: 0;
            }
            h1 {
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
<a href="index.html" style="text-decoration: none; color: rgb(255, 255, 255); position:fixed; top: 6px; left: 6px; z-index: 100; font-family: 'Comfortaa', sans-serif; font-size: 15px; font-weight: bold;">GO BACK</a>
<iframe src="background.html" style="filter:brightness(0.7); position: fixed; top: 0; left: 0; width: 100%; height: 100%; border: none; z-index: -1;"></iframe>

<div class="app-layout">
    <div class="panel center-panel" id="plot"></div>

    <div class="panel right-panel">
        <h1>Graph Models</h1>
        
        <div class="control-group">
            <div class="input-row">
                <label for="template-select">Template:</label>
                <select id="template-select">
                    <option value="line">Line</option>
                    <option value="parabola">Parabola</option>
                    <option value="supply_demand" selected>Supply & Demand</option>
                    <option value="profit_max_taker">Profit Max (Price Taker)</option>
                    <option value="profit_max_setter">Profit Max (Price Setter)</option>
                    <option value="cobb_douglas">Cobb-Douglas Optimization</option>
                </select>
            </div>
        </div>

        <div id="params-container">
            <!-- Parameters will be dynamically injected here -->
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const plotDiv = document.getElementById('plot');
    const templateSelect = document.getElementById('template-select');
    const paramsContainer = document.getElementById('params-container');

    window.graphTemplates = window.graphTemplates || {};
    const loadedTemplates = new Set();

    function loadTemplateScript(templateName, callback) {
        if (loadedTemplates.has(templateName)) {
            callback();
            return;
        }

        const script = document.createElement('script');
        script.src = `graph_templates/${templateName}.js`;
        script.onload = () => {
            loadedTemplates.add(templateName);
            callback();
        };
        script.onerror = () => {
            console.error(`Error loading template: ${templateName}`);
        };
        document.head.appendChild(script);
    }

    function updatePlot() {
        const selectedTemplate = templateSelect.value;
        const activeTemplate = window.graphTemplates[selectedTemplate];
        if (!activeTemplate) return;

        const params = {};
        paramsContainer.querySelectorAll('.param').forEach(input => {
            params[input.dataset.param] = parseFloat(input.value);
            if (isNaN(params[input.dataset.param])) params[input.dataset.param] = 0;
        });
        
        const outputEl = paramsContainer.querySelector('.output-div');
        const traces = activeTemplate.plot(params, outputEl);
        
        const layout = {
            title: activeTemplate.name,
            template: 'plotly_dark',
            paper_bgcolor: 'rgba(0,0,0,0)',
            plot_bgcolor: 'rgba(0,0,0,0)',
            font: { family: 'Comfortaa, sans-serif', color: '#fff' },
            legend: { x: 1, y: 1, xanchor: 'right' },
            xaxis: { title: activeTemplate.xaxis, rangemode: 'tozero', zeroline: false, fixedrange: true, gridcolor: 'rgba(255, 255, 255, 0.4)' },
            yaxis: { title: activeTemplate.yaxis, rangemode: 'tozero', zeroline: false, fixedrange: true, gridcolor: 'rgba(255, 255, 255, 0.4)' },
            transition: {
                duration: 200,
                easing: 'cubic-in-out'
            },
            margin: { l: 40, r: 25, b: 40, t: 40 }
        };

        Plotly.react(plotDiv, traces, layout, { responsive: true, displayModeBar: false });
    }

    function switchTemplate() {
        const selectedTemplate = templateSelect.value;
        
        loadTemplateScript(selectedTemplate, () => {
            const template = window.graphTemplates[selectedTemplate];
            if (!template) return;
            
            paramsContainer.innerHTML = template.generateHTML();
            updatePlot();
        });
    }

    templateSelect.addEventListener('change', switchTemplate);
    paramsContainer.addEventListener('input', (e) => {
        if (e.target.classList.contains('param')) {
            updatePlot();
        }
    });

    switchTemplate();
});
</script>
</body>
</html>
